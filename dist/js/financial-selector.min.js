var CONFIG={FINANCIAL_SERVER_URL:"http://contentfinancial2-test.appspot.com/"};angular.module("risevision.widget.common.financial",["risevision.widget.common.financial.service"]).directive("financialSelector",["$document","$window","$log","$templateCache",function(e,n,t,i){return{restrict:"AE",scope:{instruments:"=",viewId:"@"},template:i.get("financial-selector-template.html"),link:function(n,t){e[0],$(t)}}}]),angular.module("risevision.widget.common.financial").directive("instrumentSelect",["financialService",function(e){return{restrict:"A",link:function(n,t){function i(){var e=a.val();e&&-1===$.inArray(e,n.instruments)&&(n.instruments.push(e),a.select2("val",""))}var a=$(t);a.bind("change",function(){n.$apply(i())}),a.select2({minimumInputLength:1,placeholder:"Add an instrument...",query:function(n){n.term&&e.getInstruments({search:n.term}).then(function(e){e&&n.callback({results:e})})}})}}}]),angular.module("risevision.widget.common.financial").directive("tagManager",["$templateCache",function(e){return{restrict:"E",scope:{tags:"="},template:e.get("tag-manager-template.html"),link:function(e){e.remove=function(n){e.tags.splice(n,1)}}}}]),angular.module("risevision.widget.common.financial.service",[]).service("financialService",["jsapiLoader","$q",function(e,n){function t(e){var n=[];for(i=0;i<e.getNumberOfRows();i++){var t={id:e.getValue(i,0),text:e.getValue(i,0)+(e.getValue(i,1)?" - "+e.getValue(i,1):"")};n.push(t)}return n}function a(e){var n=angular.lowercase(e.search),t="where ((lower(code) like '%"+n+"%') or (lower(name) like '%"+n+"%')) order by "+e.sort+" limit "+e.count+" offset "+e.cursor;return t}var r={search:"",cursor:0,count:50,sort:"code"};this.getInstruments=function(i){var o=n.defer();return i=angular.extend(r,i),e.get().then(function(e){var n=CONFIG.FINANCIAL_SERVER_URL+"lookup/local",r=new e.Query(n,{sendMethod:"scriptInjection"});r.setQuery(a(i)),r.send(function(e){try{if(e.isError())o.reject(e.getMessage());else{var n=e.getDataTable();o.resolve(t(n))}}catch(i){o.reject(i.message)}})}),o.promise},this.getInstrumentsRemote=function(t){var i=n.defer();return t=angular.extend(r,t),e.get().then(function(e){var n=CONFIG.FINANCIAL_SERVER_URL+"lookup/remote",r=new e.Query(n,{sendMethod:"scriptInjection"});r.setQuery(a(t)),r.send(function(e){try{if(e.isError())i.reject(e.getMessage());else{var n=e.getDataTable();i.resolve(callbackSuccess(n))}}catch(t){i.reject(t.message)}})}),i.promise}}]),angular.module("risevision.widget.common.financial.service").factory("jsapiLoader",["$q","$window",function(e,n){var t=!1,i={get:function(){var i=e.defer();return t||n.google.visualization?(t=!0,i.resolve(n.google.visualization)):n.google.setOnLoadCallback(function(){t=!0,i.resolve(n.google.visualization)}),i.promise}};return i}]),function(){try{app=angular.module("risevision.widget.common.financial")}catch(e){app=angular.module("risevision.widget.common.financial",[])}app.run(["$templateCache",function(e){"use strict";e.put("financial-selector-template.html",'<tag-manager class="tag-manager" tags="instruments"></tag-manager>\n<input type="hidden" instrument-select instruments="instruments" style="width:300px;">\n')}])}(),function(){try{app=angular.module("risevision.widget.common.financial")}catch(e){app=angular.module("risevision.widget.common.financial",[])}app.run(["$templateCache",function(e){"use strict";e.put("tag-manager-template.html",'<div class="tags">\n  <span ng-repeat="(idx, tag) in tags" class="label label-primary">\n    {{tag}}\n    <span class="glyphicon glyphicon-remove" ng-click="remove(idx)"></span>\n  </span>\n</div>\n')}])}();
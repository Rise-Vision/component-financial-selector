angular.module("risevision.widget.common.financial.config",[]).constant("FINANCIAL_SERVER_URL","https://contentfinancial2.appspot.com/"),angular.module("risevision.widget.common.financial",["risevision.widget.common.financial.service","risevision.widget.common.tag-manager"]).directive("financialSelector",["$templateCache",function(e){return{restrict:"AE",require:"?ngModel",scope:{instruments:"=",viewId:"@"},template:e.get("financial-selector-template.html"),link:function(e,n,t,i){i&&e.$watch("instruments",function(e){e&&i.$setValidity("required",e.length)},!0)}}}]),angular.module("risevision.widget.common.financial").directive("instrumentSelect",["financialService",function(e){return{restrict:"A",link:function(n,t){function i(){var e=a.val();e&&-1===$.inArray(e,n.instruments)&&n.instruments.push(e),a.select2("val","")}var a=$(t);a.bind("change",function(){n.$apply(i())}),a.select2({minimumInputLength:1,placeholder:"Add an instrument...",query:function(n){n.term&&e.getInstruments({search:n.term}).then(function(e){e&&n.callback({results:e})},function(){})}})}}}]),angular.module("risevision.widget.common.tag-manager",[]).directive("tagManager",["$templateCache",function(e){return{restrict:"E",scope:{tags:"="},template:e.get("tag-manager-template.html"),link:function(e){e.remove=function(n){e.tags.splice(n,1)}}}}]),angular.module("risevision.widget.common.financial.service",["risevision.widget.common.financial.config"]).service("financialService",["jsapiLoader","$q","FINANCIAL_SERVER_URL",function(e,n,t){function i(e){for(var n=[],t=0;t<e.getNumberOfRows();t++){var i={id:e.getValue(t,0),text:e.getValue(t,0)+(e.getValue(t,1)?" - "+e.getValue(t,1):"")};n.push(i)}return n}function a(e){var n=angular.lowercase(e.search),t="where ((lower(code) like '%"+n+"%') or (lower(name) like '%"+n+"%')) order by "+e.sort+" limit "+e.count+" offset "+e.cursor;return t}var r={search:"",cursor:0,count:50,sort:"code"};this.getInstruments=function(o){var s=n.defer();return o=angular.extend(r,o),e.getVisualization().then(function(e){var n=t+"lookup/local",r=new e.Query(n,{sendMethod:"scriptInjection"});r.setQuery(a(o)),r.send(function(e){if(e)if(e.isError())s.reject(e.getMessage());else{var n=e.getDataTable();s.resolve(i(n))}else s.reject("No response")})}),s.promise},this.getInstrumentsRemote=function(o){var s=n.defer();return o=angular.extend(r,o),e.getVisualization().then(function(e){var n=t+"lookup/remote",r=new e.Query(n,{sendMethod:"scriptInjection"});r.setQuery(a(o)),r.send(function(e){if(e)if(e.isError())s.reject(e.getMessage());else{var n=e.getDataTable();s.resolve(i(n))}else s.reject("No response")})}),s.promise}}]),angular.module("risevision.widget.common.financial.service").factory("jsapiLoader",["$q","$window",function(e,n){var t=!1,i={getVisualization:function(){var i=e.defer();return t||n.google.visualization?(t=!0,i.resolve(n.google.visualization)):n.google.setOnLoadCallback(function(){t=!0,i.resolve(n.google.visualization)}),i.promise}};return i}]),function(){try{app=angular.module("risevision.widget.common.financial")}catch(e){app=angular.module("risevision.widget.common.financial",[])}app.run(["$templateCache",function(e){"use strict";e.put("financial-selector-template.html",'<input type="hidden" instrument-select instruments="instruments" style="width:300px;">\n<tag-manager class="tag-manager" tags="instruments"></tag-manager>\n')}])}(),function(){try{app=angular.module("risevision.widget.common.financial")}catch(e){app=angular.module("risevision.widget.common.financial",[])}app.run(["$templateCache",function(e){"use strict";e.put("tag-manager-template.html",'<div class="tags">\n  <span ng-repeat="(idx, tag) in tags" class="label label-default">\n    {{tag}}\n    <span class="fa fa-minus-circle fa-white" ng-click="remove(idx)"></span>\n  </span>\n</div>\n')}])}();
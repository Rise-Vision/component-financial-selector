var CONFIG={FINANCIAL_SERVER_URL:"http://contentfinancial2-test.appspot.com/"};angular.module("risevision.widget.common.financial",["risevision.widget.common.financial.service"]).directive("financialSelector",["$document","$window","$log","$templateCache",function(n,e,t,i){return{restrict:"AE",scope:{instruments:"=",viewId:"@"},template:i.get("financial-selector-template.html"),link:function(e,t){n[0],$(t)}}}]),angular.module("risevision.widget.common.financial").directive("instrumentList",["$document","$window","financialService","$log","$templateCache",function(n,e,t,i,a){return{restrict:"A",scope:{search:"="},template:a.get("instrument-list-template.html"),link:function(e,i){n[0],$(i);e.$watch("search",function(n){n&&t.getInstruments(n).then(function(n){n&&(e.instruments=n)})})}}}]),angular.module("risevision.widget.common.financial").directive("instrumentSelector",["$templateCache",function(n){return{restrict:"E",scope:{instruments:"="},template:n.get("instrument-selector-template.html"),link:function(n,e){var t=$(e),i=t.find("input"),a=angular.element(i);n.add=function(){n.instruments.push(n.newInstrument),n.newInstrument=""},a.bind("keypress",function(e){13==e.keyCode&&n.$apply(n.add)}),n.dropdown=function(n){n?$(".instrument-selector.dropdown").addClass("open"):$(".instrument-selector.dropdown").removeClass("open")},n.$watch("newInstrument",function(e){n.dropdown(e)})}}}]),angular.module("risevision.widget.common.financial").directive("tagManager",["$templateCache",function(n){return{restrict:"E",scope:{tags:"="},template:n.get("tag-manager-template.html"),link:function(n){n.remove=function(e){n.tags.splice(e,1)}}}}]),angular.module("risevision.widget.common.financial.service",[]).service("financialService",["jsapiLoader","$q",function(n,e){this.getInstruments=function(t,a,r,o){function s(n){var e=[];for(i=0;i<n.getNumberOfRows();i++){var t={code:n.getValue(i,0),name:n.getValue(i,1)};e.push(t)}return e}var l=e.defer();return n.get().then(function(n){var e=CONFIG.FINANCIAL_SERVER_URL+"lookup/local",i=new n.Query(e,{sendMethod:"scriptInjection"});t=angular.lowercase(t),i.setQuery("where ((lower(code) like '%"+t+"%') or (lower(name) like '%"+t+"%')) order by name limit 50 offset 0"),i.send(function(n){try{if(n.isError())callbackError(n.getMessage());else{{var e=n.getDataTable();e.getTableProperty("cursor")}l.resolve(s(e))}}catch(t){callbackError(t.message)}})}),l.promise}}]),angular.module("risevision.widget.common.financial.service").factory("jsapiLoader",["$q","$window",function(n,e){var t=!1,i={get:function(){var i=n.defer();return t||e.google.visualization?(t=!0,i.resolve(e.google.visualization)):e.google.setOnLoadCallback(function(){t=!0,i.resolve(e.google.visualization)}),i.promise}};return i}]),function(){try{app=angular.module("risevision.widget.common.financial")}catch(n){app=angular.module("risevision.widget.common.financial",[])}app.run(["$templateCache",function(n){"use strict";n.put("financial-selector-template.html",'<tag-manager class="tag-manager" tags="instruments"></tag-manager>\n<instrument-selector instruments="instruments"></instrument-selector>\n')}])}(),function(){try{app=angular.module("risevision.widget.common.financial")}catch(n){app=angular.module("risevision.widget.common.financial",[])}app.run(["$templateCache",function(n){"use strict";n.put("instrument-list-template.html",'<li class="dropdown-header">Instruments</li>\n<li class="divider"></li>\n<li ng-repeat="item in instruments">\n  <span>\n    <a href="#">{{item.code}}</a>\n    {{item.name}}\n  </span>\n</li>\n')}])}(),function(){try{app=angular.module("risevision.widget.common.financial")}catch(n){app=angular.module("risevision.widget.common.financial",[])}app.run(["$templateCache",function(n){"use strict";n.put("instrument-selector-template.html",'<div class="row">\n	<div class="col-md-6">\n    <div class="instrument-selector dropdown">\n      <input class="form-control" type="text" placeholder="Add an instrument..."\n      ng-model="newInstrument" ng-blur="dropdown(false)"></input>\n      <ul instrument-list search="newInstrument" class="dropdown-menu" role="menu">\n      </ul>\n    </div>\n  </div>\n  <div class="col-md-1">\n    <a class="btn" ng-click="add()">Add</a>\n  </div>\n</div>\n')}])}(),function(){try{app=angular.module("risevision.widget.common.financial")}catch(n){app=angular.module("risevision.widget.common.financial",[])}app.run(["$templateCache",function(n){"use strict";n.put("tag-manager-template.html",'<div class="tags">\n  <span ng-repeat="(idx, tag) in tags" class="label label-primary">\n    {{tag}}\n    <span class="glyphicon glyphicon-remove" ng-click="remove(idx)"></span>\n  </span>\n</div>\n')}])}();